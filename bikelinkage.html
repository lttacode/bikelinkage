<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">

    <script src="canvas.js"></script>
    <script src="drag.js"></script>
    <script src="constraints.js"></script>
    <script src="bikecalc.js"></script>
    <script src="linkage_controller.js"></script>
    <script src="constraints_controller.js"></script>
    <script>
      function makeCanvas(id) {
        var canvas2d = document.getElementById(id);
        var context = canvas2d.getContext("2d");
        var w = canvas2d.width;
        var h = canvas2d.height;

        var canvas = new ScaledCanvas(
          canvas2d, context, canvas2d.width, canvas2d.height,
          1500, // view port physical width: 1500mm.
          pt(w / 2, h / 2) // origin in the middle of the image.
          );

        return canvas;
      };

      function init() {
        var canvas = makeCanvas('canvasBike');
        var bike = new Enduro29_M(canvas);
        //var bike = new Orange322_17(canvas);

        var solverCanvas = makeCanvas('canvasLinkage');
        var solver = new IterativeConstraintSolver(
            solverCanvas, bike.buildConstraints(),
            10 /* epsilon */,
            50 /* max iterations */);
        solver.drawConstraints();

        var draghandler = new DragController();

        var controller = new ConstraintsController(
            solverCanvas, bike, solver, draghandler);
      }
    </script>

    <style>
    #canvasBike, #canvasLinkage {
        background:transparent;
        display: block;
        position: absolute;
        left: 0;
        top: 0;
        z-index: 0;
    }
    #canvasLinkage {
      z-index: 1;
    }
    #canvasBike {
      /* display: none; */
    }
    </style>
  </head>
  <body onLoad="javascript:init()">
    <div style="position: relative;">
      <canvas id="canvasBike" width="600" height="600"></canvas>
      <canvas id="canvasLinkage" width="600" height="600"></canvas>
    </div>
  </body>
</html>