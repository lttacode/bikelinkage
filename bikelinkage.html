<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">

    <script src="drag.js"></script>
    <script src="constraints.js"></script>
    <script src="bikecalc.js"></script>
    <script>
      function init() {
        var canvas = document.getElementById("cvs");
        var context = canvas.getContext("2d");
        var w = canvas.width;
        var h = canvas.height;

        var bike = new Enduro29_M(context, w, h, w * 0.45, h * 0.4);

        var dragging = function(dragged_index, start, end) {
          var links = bike.links, len = links.length, point = null;
          start = bike.screenToPhysCoordinates(start[0], start[1]);
          end = bike.screenToPhysCoordinates(end[0], end[1]);
          bike.drawDebugPt(start);
          bike.drawDebugPt(end);

          bike.movePoint(dragged_index, end.x, end.y);
          bike.redraw();
          bike.drawDebugPt(bike.points[dragged_index]);
        };

        var canDrag = function(start) {
          var links = bike.links, len = links.length, point = null;
          start = bike.screenToPhysCoordinates(start[0], start[1]);
          bike.drawDebugPt(start);

          var link_index = bike.findClosestPoint(start, 15);
          if (link_index != null) {
            bike.drawDebugPt(bike.points[link_index]);
          }
          return link_index;
        };

        var dragEnd = function(index, start, end) {
          bike.printData();
        };

        var draghandler = new DragController();
        draghandler.register(canvas, canDrag, dragging, dragEnd);
      }
    </script>
  </head>
  <body onLoad="javascript:init()">
    <canvas id="cvs" width="600" height="600" />
  </body>
</html>